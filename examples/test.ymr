target JavaScript_ExpressJS;

use json;
use cors;

auth Bearer as apiKey (
    source: header,
    defaultAccess: authenticated,
    mode: "FULL",
    withLogout: true
);

router /api 
    as apiRouter
{
    POST /person
        as CreatePerson
        body (
            name: string,
            age: int,
            address: {
                zipCode: int,
                street: string
            }
        )
        render form

    GET /persons
        as GetPersons
        response (
            id: int,
            name: string,
            age: int,
            address: {
                zipCode: int,
                street: string
            }
        )
        render table(
            paginate: 20,
            search: true,

            // if not specified, the columns are properties of depth 1; with @integrate, the integration actions are added
            columns: ["id", "name", "age", "address.zipCode", "address.street", "@integrate"],
            integrate: ["DeletePerson", "UpdatePerson"]
        )

    PATCH /person/:id
        as UpdatePerson
        body (
            name: string,
            age: int,
            address: {
                zipCode: int,
                street: string
            }
        )
        render form(
            updateId: ":id"
        )

    DELETE /person/:id
        as DeletePerson
}